<?xml version="1.0" encoding="UTF-8"?>
<StructureDefinition xmlns="http://hl7.org/fhir">
    <id value="ch-core-ahvn13-navs13-identifier" />
    <url value="http://fhir.ch/ig/ch-core/StructureDefinition/ch-core-ahvn13-navs13-identifier" />
    <version value="1.0.0" />
    <name value="AHVN13_NAVS13_Identifier" />
    <title value="AHVN13 / NAVS13 Identifier" />
    <status value="draft" />
    <date value="2022-05-24T15:54:24Z" />
    <publisher value="HL7 Switzerland" />
    <contact>
        <name value="HL7 Switzerland" />
        <telecom>
            <system value="url" />
            <value value="https://www.hl7.ch/" />
        </telecom>
    </contact>
    <description value="Identifier holding a 13 digit social security number" />
    <jurisdiction>
        <coding>
            <system value="urn:iso:std:iso:3166" />
            <code value="CH" />
        </coding>
    </jurisdiction>
    <fhirVersion value="4.0.1" />
    <mapping>
        <identity value="v2" />
        <uri value="http://hl7.org/v2" />
        <name value="HL7 v2 Mapping" />
    </mapping>
    <mapping>
        <identity value="rim" />
        <uri value="http://hl7.org/v3" />
        <name value="RIM Mapping" />
    </mapping>
    <mapping>
        <identity value="servd" />
        <uri value="http://www.omg.org/spec/ServD/1.0/" />
        <name value="ServD" />
    </mapping>
    <kind value="complex-type" />
    <abstract value="false" />
    <type value="Identifier" />
    <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Identifier" />
    <derivation value="constraint" />
    <differential>
        <element id="Identifier">
            <path value="Identifier" />
        </element>
        <element id="Identifier.system">
            <path value="Identifier.system" />
            <min value="1" />
            <fixedUri value="urn:oid:2.16.756.5.32" />
        </element>
        <element id="Identifier.value">
            <path value="Identifier.value" />
            <min value="1" />
            <constraint>
                <key value="ahvn13-navs13-length" />
                <severity value="error" />
                <human value="AHVN13 / NAVS13 must be exactly 13 characters long" />
                <expression value="value.matches('^[0-9]{13}$')" />
            </constraint>
            <constraint>
                <key value="ahvn13-navs13-startswith756" />
                <severity value="error" />
                <human value="AHVN13 / NAVS13 must start with 756" />
                <expression value="value.startsWith('756')" />
            </constraint>
            <constraint>
                <key value="ahvn13-navs13-digit-check" />
                <severity value="error" />
                <human value="AHVN13 / NAVS13 must pass digit check - https://www.gs1.org/services/how-calculate-check-digit-manually" />
                <expression value="(((10-(28+(value.substring(3,1).toInteger()*3)+(value.substring(4,1).toInteger()*1)+(value.substring(5,1).toInteger()*3)+(value.substring(6,1).toInteger()*1)+(value.substring(7,1).toInteger()*3)+(value.substring(8,1).toInteger()*1)+(value.substring(9,1).toInteger()*3)+(value.substring(10,1).toInteger()*1)+(value.substring(11,1).toInteger()*3))mod(10))mod(10))=value.substring(12,1).toInteger())" />
            </constraint>
        </element>
    </differential>
</StructureDefinition>